######################################################
#                                                    #
# A program by COCO DE VIENNE.                       #
# This software is licensed under the GNU GPL V3.0.  #
# You can view a copy of the license here:           #
# https://www.gnu.org/licenses/gpl-3.0.de.html       #
#                                                    #
######################################################
import sys
import requests
import os
import time
arglist = sys.argv
argslen = len(arglist)

def getException(url):
    url_string = (str(url))
    try:
        res = requests.get(url_string)
        res.raise_for_status()
        return 0
    except Exception as exc:
        print(exc)
        return 1

def download(url,filename):
    fname = (str(filename))
    dl_url = (str(url))
    res = requests.get(dl_url)
    if getException(dl_url) == 1:
        print("File not found.")
    elif getException(dl_url) == 0:
        dl_file = open(fname, "wb")
        for chunk in res.iter_content(100000):
            dl_file.write(chunk)
        dl_file.close()

def helpme():
    print("")
    print("usage: curl [file] [URL]")
    print("            [file] [HTTP]     fetches a file from an 'http' URL")
    print("            [file] [HTTPS]    fetches a file from an 'https' URL")
    print("            [file] [FTP]      fetches a file from a 'ftp' URL")
    print("")

def main():
    if argslen == 2:
        item1 = arglist[1]
        print("")
        print("No download URL found!")
        print("File name: " + str(item1))
        print("")
    elif argslen == 3:
        item1 = arglist[1]
        item2 = arglist[2]
        if item2.startswith("http") == False and item2.startswith("https") == False and item2.startswith("ftp") == False and getException(item2) == 1:
            print("")
            print("Invalid URL!")
            print("")
        elif getException(item2) != 1 and (item2.startswith("http") == True or item2.startswith("https") == True or item2.startswith("ftp") == True):
            print("Downloading file '" + str(item1) + "' from URL ('" + str(item2) + "')...")
            start_time = time.time()
            download(item2, item1)
            end_time_value = time.time()
            end_time = end_time_value - start_time
        if os.path.isfile(item1) == True:
            print("...done.")
            print("The file '" + str(item1) + "' was downloaded succesfully!")
            print("Operation completed in " + str(end_time) + " seconds.")
        elif os.path.isfile(item1) == False:
            print("There has been an Error!")
            print("The file was not downloaded!")
    else:
        helpme()

if __name__ == "__main__":
    main()
